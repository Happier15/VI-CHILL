const socket=io("");var name,vidgrid=document.getElementById("vid-grid"),mpeer=new Peer(void 0,{path:"/peerjs",host:"/",port:443});for(alert("Though you can join same room again without leaving, but it is advisable to not duplicate yourself in room to avoid technical problems and for smooth performance:)");;){var tname=prompt("Please tell your name","");if(null!==tname&&""!==tname){name=tname;break}alert("Sorry!! you cannot come without name")}var text=$("input");$("html").keydown(e=>{13==e.which&&0!==text.val().length&&(socket.emit("message",text.val(),name),text.val(""))});const sendmsg=()=>{0!==text.val().length&&(socket.emit("message",text.val(),name),text.val(""))};socket.on("createmsg",(e,t)=>{$("ul").append(`<li class="message"><b>${t}</b><br/>${e}</li>`),scrollbottom()});const scrollbottom=()=>{let e=$(".chat_window");e.scrollTop(e.prop("scrollHeight"))};var myuserid,video_meet=!1;const peers={};var num_users=0,a=!0,v=!0;let myvidstr,mycalls=new Array;function connectNewuser(e,t){num_users++;var n=mpeer.connect("userid");n.on("open",function(){n.send(String(myuserid))});const o=document.createElement("video"),s=mpeer.call(e,myvidstr);s.on("stream",e=>{addvid(o,e)}),peers[e]=s,mycalls.push(s),s.on("close",()=>{num_users--,o.remove(),adjust_videos()})}mpeer.on("open",e=>{myuserid=e,socket.emit("join-room",Room_id,e,name)}),socket.on("user-connected",(e,t)=>{$("ul").append(`<li class="message"><b>${t} joined this room. WELCOME ${t}!! :)</b><br/></li>`)}),socket.on("user-connected-video",(e,t)=>{$("ul").append(`<li class="message"><b>${t} joined video meeting :)</b><br/></li>`),video_meet&&connectNewuser(e,myvidstr)}),socket.on("user-disconnected",e=>{peers[e]&&peers[e].close()}),socket.on("user-left-video",(e,t)=>{$("ul").append(`<li class="message"><b>${t} left video meeting :(</b><br/></li>`),peers[e]&&peers[e].close()}),mpeer.on("call",e=>{num_users++,navigator.mediaDevices.getUserMedia({video:v,audio:a}).then(t=>{peers[e.peer]=e,mycalls.push(e),e.answer(myvidstr);const n=document.createElement("video");e.on("stream",e=>{addvid(n,e)}),e.on("close",()=>{num_users--,n.remove(),adjust_videos()})})});const myvid=document.createElement("video");function start_now(){navigator.mediaDevices.getUserMedia({video:v,audio:a}).then(e=>{num_users++,addvid(myvid,myvidstr=e)}),socket.emit("joined-video",Room_id,myuserid,name)}function start_video_meeting(){alert("If you have joined video meeting in any other room then please leave that to avoid any technical problem."),video_meet=!0;var e=document.getElementsByClassName("main__left"),t=document.getElementsByClassName("main__right"),n=document.getElementsByClassName("main__controls");e[0].style.flex=.8,t[0].style.flex=.2,n[0].style.visibility="visible",vidgrid.innerHTML="",start_now()}function leave_video(){var e;for(video_meet=!1,myvidstr.getTracks().forEach(e=>{e.stop()}),document.getElementById("myvideoloc").srcObject=null,e=0;e<mycalls.length;e++)mycalls[e].close();socket.emit("user-discon-video",Room_id,myuserid,name);var t=document.getElementsByClassName("main__left"),n=document.getElementsByClassName("main__right"),o=document.getElementsByClassName("main__controls");t[0].style.flex=.2,n[0].style.flex=.8,o[0].style.visibility="hidden",vidgrid.innerHTML="";var s=document.createElement("button");s.innerHTML="Join Video",s.setAttribute("id","video_meet"),s.setAttribute("onclick","start_video_meeting()");var i=document.createElement("button");i.innerHTML="Leave Room",i.setAttribute("id","leave_chat"),i.setAttribute("onclick","leave()");var a=document.createElement("button");a.innerHTML="Copy Link",a.setAttribute("id","copy_button_old"),a.setAttribute("onclick","Copy()");var r=document.createElement("button");r.innerHTML="Invite via Email",r.setAttribute("id","sendmail"),r.setAttribute("onclick","sendEmail()"),vidgrid.append(s),vidgrid.append(a),vidgrid.append(r),vidgrid.append(i)}myvid.setAttribute("id","myvideoloc"),myvid.muted=!0;const addvid=(e,t)=>{e.srcObject=t,e.addEventListener("loadedmetadata",()=>{e.play()}),vidgrid.append(e),adjust_videos()},setmutebut=()=>{document.querySelector(".mute_button").innerHTML='\n    <i class="fas fa-microphone"></i>\n    <span>Mute</span>\n  ',document.getElementById("mute_button").style.color="green"},setunmutebut=()=>{document.querySelector(".mute_button").innerHTML='\n    <i class="unmute fas fa-microphone-slash"></i>\n    <span>Unmute</span>\n  ',document.getElementById("mute_button").style.color="red"},setoffbut=()=>{document.querySelector(".video_button").innerHTML='\n    <i class="fas fa-video"></i>\n    <span>Camera Off</span>\n  ',document.getElementsByClassName("video_button")[0].style.color="red"},setonbut=()=>{document.querySelector(".video_button").innerHTML='\n  <i class="stop fas fa-video-slash"></i>\n    <span>Camera On</span>\n  ',document.getElementsByClassName("video_button")[0].style.color="green"};function change_copy_color(){var e=document.getElementById("copy_button");"green"==e.style.color?e.style.color="white":e.style.color="green"}function adjust_videos(){var e,t,n,o=document.getElementsByTagName("video");for(num_users>=9?(e=180,t=190):num_users>=5?(e=200,t=230):num_users>=3?(e=300,t=400):(e=400,t=400),n=0;n<o.length;n++)o[n].style.height=e+"px",o[n].style.width=t+"px"}const muteunmute=()=>{myvidstr.getAudioTracks()[0].enabled?(myvidstr.getAudioTracks()[0].enabled=!1,a=!1,document.querySelector(".mute_button").innerHTML='\n    <i class="unmute fas fa-microphone-slash"></i>\n    <span>Unmute</span>\n  ',document.getElementById("mute_button").style.color="red"):(myvidstr.getAudioTracks()[0].enabled=!0,a=!0,document.querySelector(".mute_button").innerHTML='\n    <i class="fas fa-microphone"></i>\n    <span>Mute</span>\n  ',document.getElementById("mute_button").style.color="green")},camoff=()=>{myvidstr.getVideoTracks()[0].enabled?(myvidstr.getVideoTracks()[0].enabled=!1,v=!1,document.querySelector(".video_button").innerHTML='\n  <i class="stop fas fa-video-slash"></i>\n    <span>Camera On</span>\n  ',document.getElementsByClassName("video_button")[0].style.color="green"):(myvidstr.getVideoTracks()[0].enabled=!0,v=!0,document.querySelector(".video_button").innerHTML='\n    <i class="fas fa-video"></i>\n    <span>Camera Off</span>\n  ',document.getElementsByClassName("video_button")[0].style.color="red")};function Copy(e){var t=document.body.appendChild(document.createElement("input"));t.value=window.location.href,t.focus(),t.select(),document.execCommand("copy"),t.parentNode.removeChild(t)}const leave=()=>{1==confirm("Are you sure you want to leave? ")&&(socket.disconnect(name),location.replace("https://vichill.herokuapp.com"))};function sendEmail(){var e="Hi %0D%0AI "+name+" invite you to come to our meeting by clicking "+window.location.href+" %0D%0ANote : you can always start a new meeting by going to https://vichill.herokuapp.com";window.open("mailto:?subject=Inviting to chill out at ViChill&body="+e)} 

